name: Salesforce Code Analyzer and PR Close

on:
  pull_request:
    branches:
      - main

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:  
      - name: Checkout Code  
        uses: actions/checkout@v4  

      - name: Install Salesforce CLI  
        run: |
          curl -sSL https://developer.salesforce.com/media/salesforce-cli/install.sfdx-cli | bash
          export PATH=/usr/local/bin:$PATH  

      - name: Install Salesforce Code Analyzer  
        run: sfdx plugins:install @salesforce/sfdx-scanner  

      - name: Run Static Code Analysis  
        run: sfdx scanner:run --format table --target force-app  

  # close_pr:
    # if: failure()  # Этот шаг выполнится, если анализ не прошел
    # needs: analyze
    # runs-on: ubuntu-latest
    # steps:
    #   - name: Close Pull Request if analysis failed
    #     run: |
    #       echo "Closing PR due to failed analysis..."
    #       curl -X PATCH \
    #         -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
    #         -d '{"state": "closed"}' \
    #         "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}"
